%{!?_with_debug:%{!?_without_debug:%define _without_debug 0}}
%{!?_with_dbus:%{!?_without_dbus:%define _with_dbus 1}}
%{!?_with_murphyif:%{!?_without_murphyif:%define _without_murphyif 1}}

Summary: Pulseaudio module for enforcing policy decisions in the audio domain
Name: pulseaudio-module-murphy-ivi
Version:  @VERSION@
Release: 0
License: LGPLv2.1
Group: System Environment/Daemons
URL: https://github.com/otcshare/pulseaudio-module-murphy-ivi
Source0: %{name}-%{version}.tar.gz
BuildRoot: %{_tmppath}/%{name}-%{version}-%{release}-root
BuildRequires: pulseaudio-module-devel
BuildRequires: pulseaudio-libs-devel
BuildRequires: dbus-devel
BuildRequires: libtool-ltdl-devel
BuildRequires: glib2-devel
Requires: pulseaudio
Conflicts: pulseaudio-module-combine-sink
Conflicts: pulseaudio-module-augment-properties

%define _unpackaged_files_terminate_build 0

%description
This package contains a pulseaudio module that enforces (mostly audio) routing,
corking and muting policy decisions.

%prep
%setup -q

%build
MODDIR="`pkg-config --variable modlibexecdir pulseaudio-module-devel`"
CONFIG_OPTIONS="--disable-static \
                --with-module-dir=$MODDIR"

%if %{?_with_dbus:1}%{!?_with_dbus:0}
CONFIG_OPTIONS="$CONFIG_OPTIONS --with-dbus"
%endif
%if %{?_with_murphyif:1}%{!?_with_murphyif:0}
CONFIG_OPTIONS="$CONFIG_OPTIONS --with-murphyif"
%endif

./bootstrap.sh
unset LD_AS_NEEDED
%configure $CONFIG_OPTIONS

%if %{?_with_debug:1}%{!?_with_debug:0}
export CFLAGS="-O0 -g3"
V="V=1"
%endif

make $V

%install
rm -rf $RPM_BUILD_ROOT
%make_install
rm -f %{_libdir}/pulse-*/modules/module-*.la

    
%clean
#rm -rf $RPM_BUILD_ROOT

%post -p /sbin/ldconfig

%postun -p /sbin/ldconfig

%files
%defattr(-,root,root,-)
%{_sysconfdir}/pulse/murphy-ivi.lua
%{_libdir}/pulse-*/modules/module-*.so
%if %{?_with_dbus:1}%{!?_with_dbus:0}
%{_sysconfdir}/dbus-1/system.d/pulseaudio-murphy-ivi.conf
%endif
